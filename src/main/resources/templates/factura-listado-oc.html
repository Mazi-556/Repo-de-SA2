<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
<head>
    <title>Ã“rdenes de Compra para Factura</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <link href="/css/navbar-style.css" rel="stylesheet">
</head>
<body>
<div th:replace="~{fragments/navbar :: navbarFragment}"></div>
<div class="container mt-4">
    <div class="d-flex justify-content-between align-items-center mb-4">
        <div>
            <h2>FacturaciÃ³n - Ã“rdenes de Compra</h2>
            <p class="text-muted mb-0" th:if="${mostrar == 'pendientes'}">
                Seleccione una orden recibida para generar su factura
            </p>
            <p class="text-muted mb-0" th:if="${mostrar == 'facturadas'}">
                Listado de Ã³rdenes de compra ya facturadas
            </p>
        </div>
        
        <!-- Botones de toggle -->
        <div class="btn-group" role="group">
            <a th:href="@{/facturas(mostrar=pendientes)}" 
               th:classappend="${mostrar == 'pendientes' ? 'active' : ''}"
               class="btn btn-outline-primary">
                ðŸ“‹ Pendientes de Facturar
            </a>
            <a th:href="@{/facturas(mostrar=facturadas)}" 
               th:classappend="${mostrar == 'facturadas' ? 'active' : ''}"
               class="btn btn-outline-success">
                âœ… Facturadas
            </a>
        </div>
    </div>

    <table class="table table-striped table-hover">
        <thead>
            <tr>
                <th>ID Orden</th>
                <th>Proveedor</th>
                <th>Fecha</th>
                <th>Total</th>
                <th>Estado</th>
                <th th:if="${#authorization.expression('hasRole(''ADMIN'')')}">Creado Por</th>
                <th th:if="${#authorization.expression('hasRole(''ADMIN'')')}">Fecha Reg.</th>
                <th>Acciones</th>
            </tr>
        </thead>
        <tbody>
            <tr th:each="orden : ${ordenes}">
                <td th:text="${orden.id}"></td>
                <td th:text="${orden.proveedor.nombre}"></td>
                <td th:text="${#temporals.format(orden.fecha, 'dd/MM/yyyy')}"></td>
                <td th:text="${'$' + #numbers.formatDecimal(orden.total, 1, 'POINT', 2, 'COMMA')}"></td>
                <td>
                    <span th:if="${orden.estado.name() == 'FACTURADA'}" class="badge bg-success">âœ… FACTURADA</span>
                    <span th:if="${orden.estado.name() == 'RECIBIDA_COMPLETA'}" class="badge bg-info">ðŸ“¦ RECIBIDA</span>
                    <span th:if="${orden.estado.name() == 'RECIBIDA_PARCIAL'}" class="badge bg-warning">ðŸ“¦ PARCIAL</span>
                </td>
                <td th:if="${#authorization.expression('hasRole(''ADMIN'')')}" th:text="${orden.creadoPor}"></td>
                <td th:if="${#authorization.expression('hasRole(''ADMIN'')')}" th:text="${#temporals.format(orden.fechaCreacion, 'dd/MM/yyyy HH:mm')}"></td>
                <td>
                    <a th:if="${mostrar == 'pendientes'}" 
                    th:href="@{/facturas/nuevo/{id}(id=${orden.id})}" 
                    class="btn btn-primary btn-sm">
                        ðŸ“„ Facturar
                    </a>
                    <span th:if="${mostrar == 'facturadas'}" class="text-muted">
                        Ya facturada
                    </span>
                </td>
            </tr>
        </tbody>
    </table>
</div>
<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
</body>
</html>
